setwd("/Users/dphnrome/Documents/Git/MassElections")
d <- read.csv("./rawData/votePercents.csv")
library(plyr)
library(ggplot2)
library(scales) # for changing from scientific notation
library(reshape2)
lime_green = "#2ecc71"
soft_blue = "#3498db"
pinkish_red = "#e74c3c"
purple = "#9b59b6"
teele = "#1abc9c"
nice_blue = "#2980b9"
my.theme <-
theme(#plot.background = element_rect(fill="white"), # Remove background
panel.grid.major = element_blank(), # Remove gridlines
# panel.grid.minor = element_blank(), # Remove more gridlines
# panel.border = element_blank(), # Remove border
panel.background = element_blank(), # Remove more background
axis.ticks = element_blank(), # Remove axis ticks
axis.text=element_text(size=6), # Enlarge axis text font
axis.title=element_text(size=8), # Enlarge axis title font
plot.title=element_text(size=12) # Enlarge, left-align title
,axis.text.x = element_text(angle=60, hjust = 1) # Uncomment if X-axis unreadable
)
ggplot(d, aes(x=d$Baker)) + geom_histogram(binwidth=.03, colour="white", fill=pinkish_red) +
my.theme + ggtitle("Votes for Baker") + xlab("Percent of City/Town's Vote")+ylab("Number of Cities/Towns") +
scale_x_continuous(labels = percent)
dma <- read.csv("./rawData/MassData.csv")
view(dma)
View(dma)
View(d)
dma$Municipality <- dma$Geography
d <- merge(d, dma, id="Municipality")
dma$Municipality <- dma$Geography
dma <- read.csv("./rawData/MassData.csv")
setwd("/Users/dphnrome/Documents/Git/MassElections")
d <- read.csv("./rawData/votePercents.csv")
dma <- read.csv("./rawData/MassData.csv")
# KIA: this script will merge all of the data in the final data source
# Loads in crime rates and cleans the agency
FBICrime <- read.csv(file="~/Documents/Dan/KIA/FinalData/FBICrime.csv",header=TRUE,sep=",")
FBICrime$Agency <- gsub(" Police Dept", "", FBICrime$Agency)
FBICrime$Agency <- gsub(" Police Department", "", FBICrime$Agency)
FBICrime <- read.csv(file="~/Documents/Dan/Work/old/KIA/FinalData/FBICrime.csv",header=TRUE,sep=",")
View(FBICrime)
# Loads 2010CensusSF1 and cleans it
TenCensusSF1 <- read.csv(file="~/Documents/Dan/Work/old/KIA/FinalData/2010CensusSF1.csv",header=TRUE,sep=",")
TenCensusSF1$Geography <- gsub(" CDP, Massachusetts", "", TenCensusSF1$Geography)
TenCensusSF1$Geography <- gsub(" Town city, Massachusetts", "", TenCensusSF1$Geography)
TenCensusSF1$Geography <- gsub(" city, Massachusetts", "", TenCensusSF1$Geography)
TenCensusSF1$Geography <- gsub(" Center", "", TenCensusSF1$Geography)
# Loads 1st ACS and cleans it
ACSOne <- read.csv(file="~/Documents/Dan/KIA/RawData/2011 ACS 5 yr/ACS_11_5YR_DP02/ACS_11_5YR_DP02_with_ann.csv",header=TRUE, skip=1, sep=",")
ACSOne$Geography <- gsub(" CDP, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" Town city, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" city, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" Center", "", ACSOne$Geography)
# Loads gdata and renames variables
library(gdata)
ACSOne <- rename.vars(ACSOne, c("Estimate..HOUSEHOLDS.BY.TYPE...Total.households",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families.",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....With.own.children.under.18.years",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....Married.couple.family",
"Percent..HOUSEHOLDS.BY.TYPE...Nonfamily.households...Householder.living.alone",
"Estimate..HOUSEHOLDS.BY.TYPE...Average.household.size",
"Estimate..HOUSEHOLDS.BY.TYPE...Average.family.size",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....Female.householder..no.husband.present..family...With.own.children.under.18.years"),
c("total.households",
"percent.households.family",
"percent.households.family.w.kids.under18",
"percent.households.married.dinks",
"percent.households.singletons",
"average.household.size",
"average.family.size",
"percent.households.single.moms"))
# Break this out so I'm not renaming too many variables at once
ACSOne <- rename.vars(ACSOne, c("Percent..ANCESTRY...Irish",
"Percent..EDUCATIONAL.ATTAINMENT...Bachelor.s.degree",
"Percent..EDUCATIONAL.ATTAINMENT...Graduate.or.professional.degree",
"Percent..EDUCATIONAL.ATTAINMENT...Percent.bachelor.s.degree.or.higher",
"Estimate..FERTILITY...Number.of.women.15.to.50.years.old.who.had.a.birth.in.the.past.12.months",
"Percent..LANGUAGE.SPOKEN.AT.HOME...English.only",
"Percent..LANGUAGE.SPOKEN.AT.HOME...Language.other.than.English",
"Percent..MARITAL.STATUS...Never.married"),
c("percent.irish",
"percent.bachelor.s.degree",
"graduate.or.professional.degree",
"percent.bachelor.s.degree.or.higher",
"female.fertility.rate",
"percent.English.only",
"percent.other.than.English",
"percent.never.married"))
# Break this out so I'm not renaming too many variables at once
ACSOne <- rename.vars(ACSOne, c("Percent..PLACE.OF.BIRTH...Native...Born.in.United.States",
"Percent..PLACE.OF.BIRTH...Native...Born.in.United.States...Different.state",
"Percent..RESIDENCE.1.YEAR.AGO...Same.house",
"Percent..SCHOOL.ENROLLMENT...College.or.graduate.school",
"Percent..SCHOOL.ENROLLMENT...Elementary.school..grades.1.8.",
"Percent..SCHOOL.ENROLLMENT...Kindergarten",
"Percent..PLACE.OF.BIRTH...Foreign.born",
"Percent..SCHOOL.ENROLLMENT...Nursery.school..preschool"),
c("percent.born.in.US",
"percent.born.in.US.not.MA",
"percent.residence.1.yr.ago.same.house",
"percent.college.or.grad.school",
"Percent.grades.1to8.",
"percent.kindergarten",
"percent.foreign.born",
"percent.preschool"))
# Loads 1st ACS and cleans it
ACSOne <- read.csv(file="~/Documents/Dan/Work/old/KIA/RawData/2011 ACS 5 yr/ACS_11_5YR_DP02/ACS_11_5YR_DP02_with_ann.csv",header=TRUE, skip=1, sep=",")
ACSOne$Geography <- gsub(" CDP, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" Town city, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" city, Massachusetts", "", ACSOne$Geography)
ACSOne$Geography <- gsub(" Center", "", ACSOne$Geography)
# Loads gdata and renames variables
ACSOne <- rename.vars(ACSOne, c("Estimate..HOUSEHOLDS.BY.TYPE...Total.households",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families.",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....With.own.children.under.18.years",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....Married.couple.family",
"Percent..HOUSEHOLDS.BY.TYPE...Nonfamily.households...Householder.living.alone",
"Estimate..HOUSEHOLDS.BY.TYPE...Average.household.size",
"Estimate..HOUSEHOLDS.BY.TYPE...Average.family.size",
"Percent..HOUSEHOLDS.BY.TYPE...Family.households..families....Female.householder..no.husband.present..family...With.own.children.under.18.years"),
c("total.households",
"percent.households.family",
"percent.households.family.w.kids.under18",
"percent.households.married.dinks",
"percent.households.singletons",
"average.household.size",
"average.family.size",
"percent.households.single.moms"))
# Break this out so I'm not renaming too many variables at once
ACSOne <- rename.vars(ACSOne, c("Percent..ANCESTRY...Irish",
"Percent..EDUCATIONAL.ATTAINMENT...Bachelor.s.degree",
"Percent..EDUCATIONAL.ATTAINMENT...Graduate.or.professional.degree",
"Percent..EDUCATIONAL.ATTAINMENT...Percent.bachelor.s.degree.or.higher",
"Estimate..FERTILITY...Number.of.women.15.to.50.years.old.who.had.a.birth.in.the.past.12.months",
"Percent..LANGUAGE.SPOKEN.AT.HOME...English.only",
"Percent..LANGUAGE.SPOKEN.AT.HOME...Language.other.than.English",
"Percent..MARITAL.STATUS...Never.married"),
c("percent.irish",
"percent.bachelor.s.degree",
"graduate.or.professional.degree",
"percent.bachelor.s.degree.or.higher",
"female.fertility.rate",
"percent.English.only",
"percent.other.than.English",
"percent.never.married"))
# Break this out so I'm not renaming too many variables at once
ACSOne <- rename.vars(ACSOne, c("Percent..PLACE.OF.BIRTH...Native...Born.in.United.States",
"Percent..PLACE.OF.BIRTH...Native...Born.in.United.States...Different.state",
"Percent..RESIDENCE.1.YEAR.AGO...Same.house",
"Percent..SCHOOL.ENROLLMENT...College.or.graduate.school",
"Percent..SCHOOL.ENROLLMENT...Elementary.school..grades.1.8.",
"Percent..SCHOOL.ENROLLMENT...Kindergarten",
"Percent..PLACE.OF.BIRTH...Foreign.born",
"Percent..SCHOOL.ENROLLMENT...Nursery.school..preschool"),
c("percent.born.in.US",
"percent.born.in.US.not.MA",
"percent.residence.1.yr.ago.same.house",
"percent.college.or.grad.school",
"Percent.grades.1to8.",
"percent.kindergarten",
"percent.foreign.born",
"percent.preschool"))
c <- read.csv("./rawData/2010CensusSF1.csv")
acs <- read.csv("./rawData/ACSOne.csv")
View(acs)
View(c)
View(acs)
View(c)
c <- read.csv("./rawData/2010CensusSF1.csv")
c$Geography <- gsub(" CDP, Massachusetts", "", c$Geography)
c$Geography <- gsub(" Town city, Massachusetts", "", c$Geography)
c$Geography <- gsub(" city, Massachusetts", "", c$Geography)
c$Geography <- gsub(" Center", "", c$Geography)
View(c)
acs$Municipality <- acs$Geography
c$Municipality <- c$Geography
d <- merge(d, c, acs, id="Municipality")
d <- read.csv("./rawData/votePercents.csv")
acs <- read.csv("./rawData/ACSOne.csv")
acs$Municipality <- acs$Geography
c$Municipality <- c$Geography
d <- merge(d, c, acs, id="Municipality")
d <- merge(d, c, acs, by="Municipality")
View(d)
View(c)
d <- merge(d, c, by="Municipality")
d <- merge(d, acs, by="Municipality")
setwd("/Users/dphnrome/Documents/Git/MassElections")
d <- read.csv("./rawData/votePercents.csv")
c <- read.csv("./rawData/2010CensusSF1.csv")
c$Geography <- gsub(" CDP, Massachusetts", "", c$Geography)
c$Geography <- gsub(" Town city, Massachusetts", "", c$Geography)
c$Geography <- gsub(" city, Massachusetts", "", c$Geography)
c$Geography <- gsub(" Center", "", c$Geography)
acs <- read.csv("./rawData/ACSOne.csv")
acs$Municipality <- acs$Geography
c$Municipality <- c$Geography
d <- merge(d, c, by="Municipality")
View(d)
d <- read.csv("./rawData/votePercents.csv")
dma <- merge(d, c, by="Municipality")
View(d)
View(dma)
View(c)
dma <- merge(d, c, by="Municipality", all=TRUE)
View(dma)
dma <- read.csv("./rawData/MassData.csv")
dma$Municipality <- dma$Geography
dma <- merge(dma, d, by="Municipality")
setwd("/Users/dphnrome/Documents/Git/MassElections")
d <- read.csv("./rawData/votePercents.csv")
library(plyr)
library(ggplot2)
library(scales) # for changing from scientific notation
library(reshape2)
# Maping tools
require("rgdal") # requires sp, will use proj.4 if installed
require("maptools")
require("ggplot2")
require("plyr")
require("RColorBrewer")
require("ggmap")
#### Map it with city-town GIS layer ####
# https://github.com/hadley/ggplot2/wiki/plotting-polygon-shapefiles
# http://www.kevjohnson.org/making-maps-in-r/
# http://www.kevjohnson.org/making-maps-in-r-part-2/
# First prepare the parcel df
mass <- readOGR(dsn="./shapefiles", layer="GISDATA_CENSUS2010TOWNS_POLY")
mass@data$id = rownames(mass@data)
names(mass)
mass.points <- fortify(mass, region="id")
mass.df <- join(mass.points, mass@data, by="id")
# Prepare data to match with "mass" gis layer
d$TOWN <- toupper(d$Municipality)
# Combine data
mass.df <- merge(mass.df, d, by="TOWN")
# Map
map <- get_map(location = "Grafton, Massachusetts", zoom=8, maptype="roadmap", color = "bw")
ggmap(map)
#### Automatic Maps ####
for(i in 27 : 46){
ggmap(map) +
geom_polygon(data=mass.df, aes(x=long, y=lat, group=group, fill=mass.df[,i]), colour=NA, alpha=0.7) +
scale_fill_gradientn(colours=(brewer.pal(9,"YlGnBu")),labels=percent) +
labs(fill="") +
theme_nothing(legend=TRUE) + ggtitle(paste("Percent of Votes for ",colnames(mass.df)[[i]],sep=""))
ggsave(paste("./plots/Map",i,".png",sep=""), dpi=300, width=6, height=5)
}
####  Visualize ####
lime_green = "#2ecc71"
soft_blue = "#3498db"
pinkish_red = "#e74c3c"
purple = "#9b59b6"
teele = "#1abc9c"
nice_blue = "#2980b9"
my.theme <-
theme(#plot.background = element_rect(fill="white"), # Remove background
panel.grid.major = element_blank(), # Remove gridlines
# panel.grid.minor = element_blank(), # Remove more gridlines
# panel.border = element_blank(), # Remove border
panel.background = element_blank(), # Remove more background
axis.ticks = element_blank(), # Remove axis ticks
axis.text=element_text(size=6), # Enlarge axis text font
axis.title=element_text(size=8), # Enlarge axis title font
plot.title=element_text(size=12) # Enlarge, left-align title
,axis.text.x = element_text(angle=60, hjust = 1) # Uncomment if X-axis unreadable
)
ggplot(d, aes(x=d$Baker)) + geom_histogram(binwidth=.03, colour="white", fill=pinkish_red) +
my.theme + ggtitle("Votes for Baker") + xlab("Percent of City/Town's Vote")+ylab("Number of Cities/Towns") +
scale_x_continuous(labels = percent)
ggsave("./plots/plot01.png", dpi=300, width=5, height=3)
ggplot(d, aes(x=d$Coakley)) + geom_histogram(binwidth=.03, colour="white", fill=nice_blue) +
my.theme + ggtitle("Votes for Coakley") + xlab("Percent of City/Town's Vote")+ylab("Number of Cities/Towns") +
scale_x_continuous(labels = percent)
ggsave("./plots/plot02.png", dpi=300, width=5, height=3)
# ggplot(mass.df, aes(x=mass.df$Coakley, weight=mass.df$POP2010)) + geom_histogram(binwidth=.03, colour="white", fill=nice_blue) +
#   my.theme + ggtitle("Votes for Coakley") + xlab("Percent of City/Town's Vote")+ylab("Number of Cities/Towns") +
#   scale_x_continuous(labels = percent) + scale_y_continuous(labels = comma)
#
# ggsave("./plots/plot04.png", dpi=300, width=5, height=3)
mass.df.top <- mass.df[which(mass.df$POP2010 > 70000),]
ggplot(mass.df.top, aes(x=reorder(mass.df.top$TOWN, -mass.df.top$Coakley), y=mass.df.top$Coakley)) + geom_bar(colour="white", fill=nice_blue) +
my.theme + ggtitle("Votes for Coakley in Cities > 70k pop.") + xlab("Cities")+ylab("Percent of City/Town's Vote") +
scale_y_continuous(labels = percent)
ggsave("./plots/plot03.png", dpi=300, width=5, height=3)
Coakley <- as.data.frame(d$Coakley)
Baker <- as.data.frame(d$Baker)
Coakley <- rename(Coakley, c("d$Coakley"="votes"))
Baker <- rename(Baker, c("d$Baker"="votes"))
Coakley$Candidate <- "Coakley"
Baker$Candidate <- "Baker"
long <- rbind(Coakley, Baker)
ggplot(long, aes(votes, fill = Candidate)) + geom_density(alpha = 0.5, colour="white") +
my.theme + ggtitle("Votes for Baker v Coakley") + xlab("Percent of City/Town's Vote")+ylab("Density") +
scale_x_continuous(labels = percent)
ggsave("./plots/plot04.png", dpi=300, width=5, height=3)
#### Census + Crime + Voting Visualization ####
# This brings in census data, which is a smaller sample, but more columns
dma <- read.csv("./rawData/MassData.csv")
dma$Municipality <- dma$Geography
d <- merge(dma, d, by="Municipality")
d <- read.table("http://www.ndbc.noaa.gov/view_text_file.php?filename=44029h2013.txt.gz&dir=data/historical/stdmet/")
View(d)
hist(d$V9)
hist(d$V9)
hist(d$V9)
hist(x=d$V9)
hist(x=d$V9, plot=TRUE)
summary(d$V())
summary(d$V9
)
d <- read.table("http://www.ndbc.noaa.gov/view_text_file.php?filename=44029h2013.txt.gz&dir=data/historical/stdmet/", header=TRUE)
View(d)
d <- read.table("http://www.ndbc.noaa.gov/view_text_file.php?filename=44029h2013.txt.gz&dir=data/historical/stdmet/")
View(d)
colnames(d) <- c("#YY", "MM", "DD", "hh", "mm", "WDIR", "WSPD", "GST", "WVHT",
"DPD", "APD", "MWD", "PRES", "ATMP", "WTMP", "DEWP", "VIS", "TIDE")
View(d)
hist(d$WVHT)
View(d)
setwd("/Users/dphnrome/Documents/Git/MassElections")
d <- read.csv("./rawData/votePercents.csv")
View(d)
hist(d$Baker)
